<script>
    const apiUrl = "https://sheetdb.io/api/v1/garbqmebupvlo";

    async function fetchUserData() {
        const email = document.getElementById("emailInput").value.trim();
        const name = document.getElementById("nameInput").value.trim().toUpperCase();

        if (!email || !name) {
            alert("Veuillez entrer votre email et votre nom.");
            return;
        }

        try {
            // Appel à l'API avec le filtre NOM + E-mail
            const response = await fetch(`${apiUrl}?E-mail=${encodeURIComponent(email)}&NOM=${encodeURIComponent(name)}`);
            const data = await response.json();

            // Vérification des résultats
            if (!data || data.length === 0) {
                alert("Aucune correspondance trouvée. Vérifiez vos informations.");
                return;
            }
            if (data.length > 1) {
                alert("Plusieurs correspondances trouvées. Veuillez contacter l'administrateur.");
                console.error("Doublons détectés :", data);
                return;
            }

            // Afficher les données utilisateur
            displayUserData(data[0]);
        } catch (error) {
            console.error("Erreur lors de la récupération des données :", error);
            alert("Erreur de communication avec le serveur. Veuillez réessayer.");
        }
    }

    function displayUserData(user) {
        document.getElementById("emailSection").style.display = "none";
        document.getElementById("userInfoSection").style.display = "block";

        document.getElementById("userName").value = user["NOM"];
        document.getElementById("userFirstName").value = user["Prénom"];
        document.getElementById("userEmail").value = user["E-mail"];

        // Charger les participations et les dates disponibles
        loadParticipationTable(user["Disponibilités"]);
        loadAvailableDates(user["Disponibilités"]);
    }
</script>
